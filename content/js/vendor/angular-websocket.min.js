/*! Ringid.com 2016-06-13 */
!function(){function a(a,b,c,j){function k(b){b&&!a.$$phase&&a.$apply()}function l(a,b){var c=b&&b.protocols;(f(b)||i(b))&&(c=b),this.requestedReconnect=!1,this.protocols=c||"Sec-WebSocket-Protocol",this.url=a||"Missing URL",this.ssl=/(wss)/i.test(this.url),this._reconnectAttempts=0,this.initialTimeout=500,this.maxTimeout=3e5,this.sendQueue=[],this.onOpenCallbacks=[],this.onMessageCallbacks=[],this.onErrorCallbacks=[],this.onCloseCallbacks=[],d(this._readyStateConstants),a?this._connect():this._setInternalState(0)}return l.prototype._readyStateConstants={CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3,RECONNECT_ABORTED:4},l.prototype._reconnectableStatusCodes=[4e3],l.prototype.close=function(a){return!a&&this.socket.bufferedAmount||this.socket.close(),this},l.prototype.setBinaryType=function(a){this.socket.binaryType="arraybuffer"},l.prototype._connect=function(a){!a&&this.socket&&this.socket.readyState===this._readyStateConstants.OPEN||(this.socket=j.createWebSocketBackend(this.url,this.protocol),this.socket.binaryType="arraybuffer",this.socket.onopen=this._onOpenHandler.bind(this),this.socket.onmessage=this._onMessageHandler.bind(this),this.socket.onerror=this._onErrorHandler.bind(this),this.socket.onclose=this._onCloseHandler.bind(this))},l.prototype.fireQueue=function(){for(;this.sendQueue.length&&this.socket.readyState===this._readyStateConstants.OPEN;){var a=this.sendQueue.shift();a.message&&(a.message=new Uint8Array(a.message.buffer),this.socket.send(!f(a.message)&&a.stringify?JSON.stringify(a.message):a.message))}},l.prototype.notifyOpenCallbacks=function(){for(var a=0;a<this.onOpenCallbacks.length;a++)this.onOpenCallbacks[a].call(this)},l.prototype.notifyCloseCallbacks=function(a){for(var b=0;b<this.onCloseCallbacks.length;b++)this.onCloseCallbacks[b].call(this,a)},l.prototype.notifyErrorCallbacks=function(a){for(var b=0;b<this.onErrorCallbacks.length;b++)this.onErrorCallbacks[b].call(this,a)},l.prototype.onOpen=function(a){return this.onOpenCallbacks.push(a),this},l.prototype.onClose=function(a){return this.onCloseCallbacks.push(a),this},l.prototype.onError=function(a){return this.onErrorCallbacks.push(a),this},l.prototype.isOpen=function(){return this.socket.readyState===this._readyStateConstants.OPEN},l.prototype.resetOnMessageHandler=function(){for(var a=this,b=0;b<a.onMessageCallbacks.length;b++)if(a.onMessageCallbacks[b].clearAble===!0)return a.onMessageCallbacks.splice(b,1),a.resetOnMessageHandler()},l.prototype.addSubscriberType=function(a){this.send({actn:500,dataType:a})},l.prototype.removeSubscriberType=function(a){this.send({actn:501,dataType:a})},l.prototype.onMessage=function(a,b){if(!g(a))throw new Error("Callback must be a function");if(b=b||{},b&&h(b.filter)&&!f(b.filter)&&!(b.filter instanceof RegExp)&&!g(b.filter))throw new Error("Pattern must be a string or regular expression");return this.onMessageCallbacks.push({key:b.key||"",fn:a,pattern:b.filter||void 0,autoApply:b.autoApply||!1,clearAble:b.clearAble||!0,dataType:b.dataType||0}),this},l.prototype.changeDataFormat=function(a){a=a||"arraybuffer",this.binaryType=a},l.prototype._onOpenHandler=function(){this._reconnectAttempts=0,this.fireQueue(),this.notifyOpenCallbacks(),this.requestedReconnect&&(this.requestedReconnect=!1)},l.prototype._onCloseHandler=function(a){this.notifyCloseCallbacks(a),this._reconnectableStatusCodes.indexOf(a.code)>-1&&this.reconnect()},l.prototype._onErrorHandler=function(a){this.notifyErrorCallbacks(a)},l.prototype._onMessageHandler=function(a){for(var b,c,d,e=this,h=0;h<e.onMessageCallbacks.length;h++)d=e.onMessageCallbacks[h],b=d.pattern,b?g(b)?(c=b.call(null,a),c!==!1&&(d.fn.call(this,c),k(d.autoApply))):f(b)&&a.data===b?(d.fn.call(this,a),k(d.autoApply)):b instanceof RegExp&&b.exec(a.data)&&(d.fn.call(this,a),k(d.autoApply)):(d.fn.call(this,a),k(d.autoApply))},l.prototype.send=function(a,b){var c=this;return c.readyState===c._readyStateConstants.RECONNECT_ABORTED?!1:(this.sendQueue.push({message:a,stringify:!!b}),this.fireQueue(),!0)},l.prototype.reconnect=function(){return this.requestedReconnect||0===this.socket.readyState||this.isOpen()||(this.close(),c(angular.bind(this,function(){this._connect()}),this._getBackoffDelay(++this._reconnectAttempts),!0),this.requestedReconnect=!0),this},l.prototype._getBackoffDelay=function(a){var b=Math.random()+1,c=this.initialTimeout,d=2,e=a,f=this.maxTimeout;return Math.floor(Math.min(b*c*Math.pow(d,e),f))},l.prototype._setInternalState=function(a){if(Math.floor(a)!==a||0>a||a>4)throw new Error("state must be an integer between 0 and 4, got: "+a);e||(this.readyState=a||this.socket.readyState),this._internalConnectionState=a,angular.forEach(this.sendQueue,function(a){})},e&&e(l.prototype,"readyState",{get:function(){return this._internalConnectionState||this.socket.readyState},set:function(){throw new Error("The readyState property is read-only")}}),function(a,b){return new l(a,b)}}function b(a){this.createWebSocketBackend=function(b,c){var d,e,f=/wss?:\/\//.exec(b);if(!f)throw new Error("Invalid url provided");if("object"==typeof exports&&require)try{e=require("ws"),d=e.Client||e.client||e}catch(g){}return d=d||a.WebSocket||a.MozWebSocket,"undefined"==typeof d?!1:c?new d(b,c):new d(b)}}var c=function(){},d=Object.freeze?Object.freeze:c,e=Object.defineProperty,f=angular.isString,g=angular.isFunction,h=angular.isDefined,i=angular.isArray;a.$inject=["$rootScope","$$q","$timeout","$websocketBackend"],b.$inject=["$window"],angular.module("ngWebSocket",[]).factory("$websocket",a).factory("WebSocket",a).service("$websocketBackend",b).service("WebSocketBackend",b),angular.module("angular-websocket",["ngWebSocket"])}();